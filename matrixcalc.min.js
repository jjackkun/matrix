var MatrixCalc={type:function(t){switch(t){case 1:this.multiply=this.multiply1;break;case 2:this.multiply=this.multiply2;break;default:this.multiply=function(t,r){return t[0].length&&t[0].length==t.length?multiply2(t,r):multiply1(t,r)}}},multiply:function(t,r){return t[0].length&&t[0].length==t.length?this.multiply2(t,r):this.multiply1(t,r)},multiply1:function(t,r){for(var i=Math.sqrt(t.length),n=0,e=0,a=0,l=0,u=[],e=0;e<i;e++){a=0,l=0;for(var o=0;o<t.length;o++)n+=t[e*i+l]*r[a+l*i],l+=1,l==i&&(u.push(n),l=0,n=0,a+=1)}return u},multiply2:function(t,r){var i=t.length,n=0,e=0,a=0,l=0,u=0,o=[];for(e=0;e<i;e++)for(l=0,o[e]=[],a=0;a<i*i;a++)u=a%i,n+=t[e][u]*r[u][l],u==i-1&&(o[e].push(n),n=0,l+=1);return o},inverse:function(t){var r=0;return r=t[0].length?t[0].length:Math.sqrt(t.length),this["inverse"+r](t)},inverse3:function(t){function r(t,r){return t*u+r}function n(t){return t[r(0,0)]*t[r(1,1)]*t[r(2,2)]+t[r(0,1)]*t[r(1,2)]*t[r(2,0)]+t[r(0,2)]*t[r(1,0)]*t[r(2,1)]-t[r(0,0)]*t[r(1,2)]*t[r(2,1)]-t[r(0,1)]*t[r(1,0)]*t[r(2,2)]-t[r(0,2)]*t[r(1,1)]*t[r(2,0)]}var e=!1,a=[],l=0,u=0;if(t[0].length==t.length){for(u=t.length,i=0;i<u;i++)a=a.concat(t[i]);e=!0,t=a,a=[]}else u=Math.sqrt(t.length);if(l=n(t),0==l){if(1==e){for(t=[],i=0;i<u;i+=1)for(t[t.length]=[],j=0;j<u;j+=1)t[i][j]=a[i*u+j];return t}return a}if(a[r(0,0)]=(t[r(1,1)]*t[r(2,2)]-t[r(1,2)]*t[r(2,1)])/l,a[r(0,1)]=(t[r(0,2)]*t[r(2,1)]-t[r(0,1)]*t[r(2,2)])/l,a[r(0,2)]=(t[r(0,1)]*t[r(1,2)]-t[r(0,2)]*t[r(1,1)])/l,a[r(1,0)]=(t[r(1,2)]*t[r(2,0)]-t[r(1,0)]*t[r(2,2)])/l,a[r(1,1)]=(t[r(0,0)]*t[r(2,2)]-t[r(0,2)]*t[r(2,0)])/l,a[r(1,2)]=(t[r(0,2)]*t[r(1,0)]-t[r(0,0)]*t[r(1,2)])/l,a[r(2,0)]=(t[r(1,0)]*t[r(2,1)]-t[r(1,1)]*t[r(2,0)])/l,a[r(2,1)]=(t[r(0,1)]*t[r(2,0)]-t[r(0,0)]*t[r(2,1)])/l,a[r(2,2)]=(t[r(0,0)]*t[r(1,1)]-t[r(0,1)]*t[r(1,0)])/l,1==e){for(t=[],i=0;i<u;i+=1)for(t[t.length]=[],j=0;j<u;j+=1)t[i][j]=a[i*u+j];return t}return a},inverse4:function(t){function r(t,r){return t*u+r}function n(t){return t[r(0,3)]*t[r(1,2)]*t[r(2,1)]*t[r(3,0)]-t[r(0,2)]*t[r(1,3)]*t[r(2,1)]*t[r(3,0)]-t[r(0,3)]*t[r(1,1)]*t[r(2,2)]*t[r(3,0)]+t[r(0,1)]*t[r(1,3)]*t[r(2,2)]*t[r(3,0)]+t[r(0,2)]*t[r(1,1)]*t[r(2,3)]*t[r(3,0)]-t[r(0,1)]*t[r(1,2)]*t[r(2,3)]*t[r(3,0)]-t[r(0,3)]*t[r(1,2)]*t[r(2,0)]*t[r(3,1)]+t[r(0,2)]*t[r(1,3)]*t[r(2,0)]*t[r(3,1)]+t[r(0,3)]*t[r(1,0)]*t[r(2,2)]*t[r(3,1)]-t[r(0,0)]*t[r(1,3)]*t[r(2,2)]*t[r(3,1)]-t[r(0,2)]*t[r(1,0)]*t[r(2,3)]*t[r(3,1)]+t[r(0,0)]*t[r(1,2)]*t[r(2,3)]*t[r(3,1)]+t[r(0,3)]*t[r(1,1)]*t[r(2,0)]*t[r(3,2)]-t[r(0,1)]*t[r(1,3)]*t[r(2,0)]*t[r(3,2)]-t[r(0,3)]*t[r(1,0)]*t[r(2,1)]*t[r(3,2)]+t[r(0,0)]*t[r(1,3)]*t[r(2,1)]*t[r(3,2)]+t[r(0,1)]*t[r(1,0)]*t[r(2,3)]*t[r(3,2)]-t[r(0,0)]*t[r(1,1)]*t[r(2,3)]*t[r(3,2)]-t[r(0,2)]*t[r(1,1)]*t[r(2,0)]*t[r(3,3)]+t[r(0,1)]*t[r(1,2)]*t[r(2,0)]*t[r(3,3)]+t[r(0,2)]*t[r(1,0)]*t[r(2,1)]*t[r(3,3)]-t[r(0,0)]*t[r(1,2)]*t[r(2,1)]*t[r(3,3)]-t[r(0,1)]*t[r(1,0)]*t[r(2,2)]*t[r(3,3)]+t[r(0,0)]*t[r(1,1)]*t[r(2,2)]*t[r(3,3)]}var e=!1,a=[],l=0,u=0;if(t[0].length==t.length){for(u=t.length,i=0;i<u;i++)a=a.concat(t[i]);e=!0,t=a,a=[]}else u=Math.sqrt(t.length);if(l=n(t),0==l){if(1==e){for(t=[],i=0;i<u;i+=1)for(t[t.length]=[],j=0;j<u;j+=1)t[i][j]=a[i*u+j];return t}return a}if(a[r(0,0)]=(t[r(1,2)]*t[r(2,3)]*t[r(3,1)]-t[r(1,3)]*t[r(2,2)]*t[r(3,1)]+t[r(1,3)]*t[r(2,1)]*t[r(3,2)]-t[r(1,1)]*t[r(2,3)]*t[r(3,2)]-t[r(1,2)]*t[r(2,1)]*t[r(3,3)]+t[r(1,1)]*t[r(2,2)]*t[r(3,3)])/l,a[r(0,1)]=(t[r(0,3)]*t[r(2,2)]*t[r(3,1)]-t[r(0,2)]*t[r(2,3)]*t[r(3,1)]-t[r(0,3)]*t[r(2,1)]*t[r(3,2)]+t[r(0,1)]*t[r(2,3)]*t[r(3,2)]+t[r(0,2)]*t[r(2,1)]*t[r(3,3)]-t[r(0,1)]*t[r(2,2)]*t[r(3,3)])/l,a[r(0,2)]=(t[r(0,2)]*t[r(1,3)]*t[r(3,1)]-t[r(0,3)]*t[r(1,2)]*t[r(3,1)]+t[r(0,3)]*t[r(1,1)]*t[r(3,2)]-t[r(0,1)]*t[r(1,3)]*t[r(3,2)]-t[r(0,2)]*t[r(1,1)]*t[r(3,3)]+t[r(0,1)]*t[r(1,2)]*t[r(3,3)])/l,a[r(0,3)]=(t[r(0,3)]*t[r(1,2)]*t[r(2,1)]-t[r(0,2)]*t[r(1,3)]*t[r(2,1)]-t[r(0,3)]*t[r(1,1)]*t[r(2,2)]+t[r(0,1)]*t[r(1,3)]*t[r(2,2)]+t[r(0,2)]*t[r(1,1)]*t[r(2,3)]-t[r(0,1)]*t[r(1,2)]*t[r(2,3)])/l,a[r(1,0)]=(t[r(1,3)]*t[r(2,2)]*t[r(3,0)]-t[r(1,2)]*t[r(2,3)]*t[r(3,0)]-t[r(1,3)]*t[r(2,0)]*t[r(3,2)]+t[r(1,0)]*t[r(2,3)]*t[r(3,2)]+t[r(1,2)]*t[r(2,0)]*t[r(3,3)]-t[r(1,0)]*t[r(2,2)]*t[r(3,3)])/l,a[r(1,1)]=(t[r(0,2)]*t[r(2,3)]*t[r(3,0)]-t[r(0,3)]*t[r(2,2)]*t[r(3,0)]+t[r(0,3)]*t[r(2,0)]*t[r(3,2)]-t[r(0,0)]*t[r(2,3)]*t[r(3,2)]-t[r(0,2)]*t[r(2,0)]*t[r(3,3)]+t[r(0,0)]*t[r(2,2)]*t[r(3,3)])/l,a[r(1,2)]=(t[r(0,3)]*t[r(1,2)]*t[r(3,0)]-t[r(0,2)]*t[r(1,3)]*t[r(3,0)]-t[r(0,3)]*t[r(1,0)]*t[r(3,2)]+t[r(0,0)]*t[r(1,3)]*t[r(3,2)]+t[r(0,2)]*t[r(1,0)]*t[r(3,3)]-t[r(0,0)]*t[r(1,2)]*t[r(3,3)])/l,a[r(1,3)]=(t[r(0,2)]*t[r(1,3)]*t[r(2,0)]-t[r(0,3)]*t[r(1,2)]*t[r(2,0)]+t[r(0,3)]*t[r(1,0)]*t[r(2,2)]-t[r(0,0)]*t[r(1,3)]*t[r(2,2)]-t[r(0,2)]*t[r(1,0)]*t[r(2,3)]+t[r(0,0)]*t[r(1,2)]*t[r(2,3)])/l,a[r(2,0)]=(t[r(1,1)]*t[r(2,3)]*t[r(3,0)]-t[r(1,3)]*t[r(2,1)]*t[r(3,0)]+t[r(1,3)]*t[r(2,0)]*t[r(3,1)]-t[r(1,0)]*t[r(2,3)]*t[r(3,1)]-t[r(1,1)]*t[r(2,0)]*t[r(3,3)]+t[r(1,0)]*t[r(2,1)]*t[r(3,3)])/l,a[r(2,1)]=(t[r(0,3)]*t[r(2,1)]*t[r(3,0)]-t[r(0,1)]*t[r(2,3)]*t[r(3,0)]-t[r(0,3)]*t[r(2,0)]*t[r(3,1)]+t[r(0,0)]*t[r(2,3)]*t[r(3,1)]+t[r(0,1)]*t[r(2,0)]*t[r(3,3)]-t[r(0,0)]*t[r(2,1)]*t[r(3,3)])/l,a[r(2,2)]=(t[r(0,1)]*t[r(1,3)]*t[r(3,0)]-t[r(0,3)]*t[r(1,1)]*t[r(3,0)]+t[r(0,3)]*t[r(1,0)]*t[r(3,1)]-t[r(0,0)]*t[r(1,3)]*t[r(3,1)]-t[r(0,1)]*t[r(1,0)]*t[r(3,3)]+t[r(0,0)]*t[r(1,1)]*t[r(3,3)])/l,a[r(2,3)]=(t[r(0,3)]*t[r(1,1)]*t[r(2,0)]-t[r(0,1)]*t[r(1,3)]*t[r(2,0)]-t[r(0,3)]*t[r(1,0)]*t[r(2,1)]+t[r(0,0)]*t[r(1,3)]*t[r(2,1)]+t[r(0,1)]*t[r(1,0)]*t[r(2,3)]-t[r(0,0)]*t[r(1,1)]*t[r(2,3)])/l,a[r(3,0)]=(t[r(1,2)]*t[r(2,1)]*t[r(3,0)]-t[r(1,1)]*t[r(2,2)]*t[r(3,0)]-t[r(1,2)]*t[r(2,0)]*t[r(3,1)]+t[r(1,0)]*t[r(2,2)]*t[r(3,1)]+t[r(1,1)]*t[r(2,0)]*t[r(3,2)]-t[r(1,0)]*t[r(2,1)]*t[r(3,2)])/l,a[r(3,1)]=(t[r(0,1)]*t[r(2,2)]*t[r(3,0)]-t[r(0,2)]*t[r(2,1)]*t[r(3,0)]+t[r(0,2)]*t[r(2,0)]*t[r(3,1)]-t[r(0,0)]*t[r(2,2)]*t[r(3,1)]-t[r(0,1)]*t[r(2,0)]*t[r(3,2)]+t[r(0,0)]*t[r(2,1)]*t[r(3,2)])/l,a[r(3,2)]=(t[r(0,2)]*t[r(1,1)]*t[r(3,0)]-t[r(0,1)]*t[r(1,2)]*t[r(3,0)]-t[r(0,2)]*t[r(1,0)]*t[r(3,1)]+t[r(0,0)]*t[r(1,2)]*t[r(3,1)]+t[r(0,1)]*t[r(1,0)]*t[r(3,2)]-t[r(0,0)]*t[r(1,1)]*t[r(3,2)])/l,a[r(3,3)]=(t[r(0,1)]*t[r(1,2)]*t[r(2,0)]-t[r(0,2)]*t[r(1,1)]*t[r(2,0)]+t[r(0,2)]*t[r(1,0)]*t[r(2,1)]-t[r(0,0)]*t[r(1,2)]*t[r(2,1)]-t[r(0,1)]*t[r(1,0)]*t[r(2,2)]+t[r(0,0)]*t[r(1,1)]*t[r(2,2)])/l,1==e){for(t=[],i=0;i<u;i+=1)for(t[t.length]=[],j=0;j<u;j+=1)t[i][j]=a[i*u+j];return t}return a}},MatrixTransform={type:MatrixCalc.type,multiply:MatrixCalc.multiply,multiply1:MatrixCalc.multiply1,multiply2:MatrixCalc.multiply2,matrix2dI:[1,0,0,0,1,0,0,0,1],matrix3dI:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],translate:function(t,r){var i="2";return i=arguments[0].length,this["translate"+i+"D"](t,r)},translate2D:function(t,r){var i=[1,0,0,0,1,0,t[0],t[1],1];return r=r?r:this.matrix2dI,this.multiply(r,i)},translate3D:function(t,r){var i=[1,0,0,0,0,1,0,0,0,0,1,0,t[0],t[1],t[2],1];return r=r?r:this.matrix3dI,this.multiply(r,i)},rotate:function(t,r){var i="2";return i=t.length?t.length:2,this["rotate"+i+"D"](t,r)},rotate2D:function(t,r){var i=0,n=0,e=[];return t=t*Math.PI/180,i=Math.cos(t),n=Math.sin(t),r=r?r:this.matrix2dI,e=[i,-n,0,n,i,0,0,0,1],this.multiply(r,e)},rotateX:function(t,r){var i=0,n=0,e=[];return t=t*Math.PI/180,i=Math.cos(t),n=Math.sin(t),r=r?r:this.matrix3dI,e=[1,0,0,0,0,i,n,0,0,-n,i,0,0,0,0,1],this.multiply(r,e)},rotateY:function(t,r){var i=0,n=0,e=[];return t=t*Math.PI/180,i=Math.cos(t),n=Math.sin(t),r=r?r:this.matrix3dI,e=[i,0,-n,0,0,1,0,0,n,0,i,0,0,0,0,1],this.multiply(r,e)},rotateZ:function(t,r){var i=0,n=0,e=[];return t=t*Math.PI/180,i=Math.cos(t),n=Math.sin(t),r=r?r:this.matrix3dI,e=[i,n,0,0,-n,i,0,0,0,0,1,0,0,0,0,1],this.multiply(r,e)},rotate3D:function(t,r){return r=this.rotateX(t[0],r),r=this.rotateY(t[1],r),r=this.rotateZ(t[2],r)},scale:function(t,r){return t.length?this.scale3D(t,r):this.scale2D([t,t],r)},scale2D:function(t,r){var i;return r=r?r:this.matrix2dI,i=[t[0],0,0,0,t[1],0,0,0,1],this.multiply(i,r)},scale3D:function(t,r){var i=[];return r=r?r:this.matrix3dI,i=[t[0],0,0,0,0,t[1],0,0,0,0,t[2]||1,0,0,0,0,1],this.multiply(i,r)},perspective:function(t,r,i,n){var e=Math.tan(.5*Math.PI-.5*t),a=1/(i-n);return[e/r,0,0,0,0,e,0,0,0,0,(i+n)*a,-1,0,0,i*n*a*2,0]},lookAt:function(t,r,i){i=i?i:[0,1,0];var n=Vector.normalize(Vector.subtract(cameraPosition,r)),e=Vector.cross(i,n),a=Vector.cross(n,e);return[e[0],e[1],e[2],0,a[0],a[1],a[2],0,n[0],n[1],n[2],0,cameraPosition[0],cameraPosition[1],cameraPosition[2],1]},cameraForElement:function(t,r,i){var n,e,a,l;n=this.lookAt(t,target,[0,1,0]),e=this.inverse(n);for(var u=0;u<target.lenght;u++){var o=target[u];a=this.matrix3dI;for(var h in o)a=this[h](a,o[h]),l[u]=MatrixCalc.multiply(a,e),o.hasOwnProperty("element")&&(element.style.transform="matrix3d("+l[u]+")")}}},Vector={cross:function(t,r){return[t[1]*r[2]-t[2]*r[1],t[2]*r[0]-t[0]*r[2],t[0]*r[1]-t[1]*r[0]]},normalize:function(t){var r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return r>1e-5?[t[0]/r,t[1]/r,t[2]/r]:[0,0,0]},dot:function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]},subtract:function(t,r){return[t[0]-r[0],t[1]-r[1],t[2]-r[2]]}};